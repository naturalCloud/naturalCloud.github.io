---
title: dockerfile
date: 2022-06-02 19:05:39
permalink: /pages/048dca/
categories:
  - docker
tags:
  - 
author: 
  name: yunqi
  link: https://github.com/naturalCloud
---




## 简介
构建docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。

![](https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/dockfile.md/376804783807220.png)

文档地址 [dockerfile doc](https://docs.docker.com/engine/reference/builder/)

## 概念解释
从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，
*  Dockerfile是软件的原材料
*  Docker镜像是软件的交付品
*  Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例
   Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。

![](https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/dockfile.md/344726515901360.png)

* Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西

  Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;

*  Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;

* Docker容器，容器是直接提供服务的。

## 执行流程

Docker执行Dockerfile的大致流程
* docker从基础镜像运行一个容器
* 执行一条指令并对容器作出修改
* 执行类似docker commit的操作提交一个新的镜像层
* docker再基于刚提交的镜像运行一个新容器
* 执行dockerfile中的下一条指令直到所有指令都执行完成

## dockefile 语法

### FROM

基础镜像，来自哪里

### MAINTAINER
镜像维护者的姓名和邮箱地址

### RUN
容容器构建时执行的命令,docker build时运行
两种格式
* **shell**

![](https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/dockfile.md/43431617648738.png)
* **exec** 格式

![](https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/dockfile.md/270681664549278.png)

### EXPOSE
对外暴露的端口


### WORKDIR

指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点

### USER
指定该镜像以什么样的用户去执行，如果都不指定，默认是roo
### ENV
构建时候的环境变量
### ADD
将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包
### COPY
类似ADD，拷贝文件和目录到镜像中。 将从构建上下文目录中 <源路径> 的文件/目录复制到新的一层的镜像内的 <目标路径> 位置

`COPY src dest`

`COPY ["src", "dest"]`
<src源路径>：源文件或者源目录
<dest目标路径>：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。
### VOLUME
容器数据卷，用于数据保存和持久化工作
### CMD
指定容器启动后的要干的事情,但只有最后一个生效，CMD 会被 docker run 之后的参数替换

### ENTRYPOINT
也是用来指定一个容器启动时要运行的命令
类似于 CMD 指令，但是ENTRYPOINT不会被docker run后面的命令覆盖， 而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序

![](https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/dockfile.md/188423753751680.png)



|     是否传参     |     按照dockerfile编写执行      |                    传参运行                    |
| --------------- | ------------------------------ | --------------------------------------------- |
| Docker命令      | docker run  nginx:test         | docker run  nginx:test -c /etc/nginx/new.conf |
| 衍生出的实际命令 | nginx -c /etc/nginx/nginx.conf | nginx -c /etc/nginx/new.conf                  |

## 编写dockerfile

```dockerfile

```