(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{501:function(s,e,a){"use strict";a.r(e);var t=a(31),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" redis")]),s._v(" "),a("h2",{attrs:{id:"创建6台redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建6台redis"}},[s._v("#")]),s._v(" 创建6台redis")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ocker run -d --name redis-node-1 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-1:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis-node-2 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-2:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6382")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis-node-3 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-3:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6383")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis-node-4 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-4:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6384")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis-node-5 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-5:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6385")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis-node-6 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-6:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6386")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"在-redis-node-1-节点创建集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-redis-node-1-节点创建集群"}},[s._v("#")]),s._v(" 在 "),a("strong",[s._v("redis-node-1")]),s._v(" 节点创建集群")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录 redis-node-1 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-node-1 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nredis-cli --cluster create "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6381 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6382 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6383 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6384 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6385 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6386 --cluster-replicas "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如下成功")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n..\n>>> Performing Cluster Check (using node 192.168.124.22:6381)\nM: 5f49bebc4a8835595f9fb29e08b4b17115be8139 192.168.124.22:6381\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nM: 5b868dd18ddcabb565e39eafb200ba0af0f07a54 192.168.124.22:6382\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nS: da7b7ceb92c70f4eec3576d63dc56a2ecfcc8fd3 192.168.124.22:6384\n   slots: (0 slots) slave\n   replicates 5b868dd18ddcabb565e39eafb200ba0af0f07a54\nM: f40dc66b16328eb33e0f01069c781f37c470d95e 192.168.124.22:6383\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nS: 08bd21a0a166e9737a3439e71b751102b9ec79cb 192.168.124.22:6386\n   slots: (0 slots) slave\n   replicates 5f49bebc4a8835595f9fb29e08b4b17115be8139\nS: 7f99c5a99db3144c102b21821e6e98397626d90d 192.168.124.22:6385\n   slots: (0 slots) slave\n   replicates f40dc66b16328eb33e0f01069c781f37c470d95e\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h2",{attrs:{id:"扩缩容-redis-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩缩容-redis-集群"}},[s._v("#")]),s._v(" 扩缩容 "),a("strong",[s._v("redis")]),s._v(" 集群")]),s._v(" "),a("h3",{attrs:{id:"扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容"}},[s._v("#")]),s._v(" 扩容")]),s._v(" "),a("ol",[a("li",[s._v("在添加两个节点")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis-node-7 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-7:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6387")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis-node-8 --net "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" --privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -v /tmp/redis/share/redis-node-8:/data redis:6.0.8 --cluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --appendonly "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" --port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6388")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("添加 6387 为 "),a("strong",[s._v("master")]),s._v(" 节点")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-node7 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nredis-cli --cluster add-node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6387 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6381\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("/home/zhangshuai/.ssh/github_dev_id_rsa\n3. 检查集群 solt 槽情况")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli --cluster check "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6381\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如下，新增节点没有slots 没有从服务器")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("192.168.124.22:6381 (5f49bebc...) -> 1 keys | 5461 slots | 1 slaves.\n192.168.124.22:6383 (f40dc66b...) -> 1 keys | 5461 slots | 1 slaves.\n192.168.124.22:6387 (b1240c8c...) -> 0 keys | 0 slots | 0 slaves.\n192.168.124.22:6382 (5b868dd1...) -> 0 keys | 5462 slots | 1 slaves.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("重新 reshard")])]),s._v(" "),a("p",[s._v("重新分派槽号")]),s._v(" "),a("p",[s._v("命令:"),a("code",[s._v("redis-cli --cluster reshard IP地址:端口号")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli --cluster reshard "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6381\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("操作流程如下")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/redis.md/328854396889570.png",alt:""}})]),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("检查节点 slots")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli --cluster check "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6381\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[a("p",[s._v("给刚添加的 node7 master 节点添加从服务器")]),s._v(" "),a("p",[a("code",[s._v("redis-cli --cluster add-node ip:新slave端口 ip:新master端口 --cluster-slave --cluster-master-id 新主机节点ID")])])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli --cluster add-node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6388 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6387 --cluster-slave --cluster-master-id b1240c8cb6b35e318df7093b5cfe521c98b09fc1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"7"}},[a("li",[s._v("再次检查 集群状态")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli --cluster check "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.22:6382\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/redis.md/225404025576212.png",alt:""}})]),s._v(" "),a("ol",{attrs:{start:"8"}},[a("li",[s._v("测试 登入集群 set key")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-cli -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v(" -c\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/devops/redis.md/248075824122690.png",alt:"登入集群set key"}})])])}),[],!1,null,null,null);e.default=n.exports}}]);