(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{509:function(s,a,t){"use strict";t.r(a);var e=t(31),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"namespace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#namespace"}},[s._v("#")]),s._v(" namespace")]),s._v(" "),t("h3",{attrs:{id:"创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[s._v("#")]),s._v(" 创建")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl create namespace my-ns \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[s._v("#")]),s._v(" 删除")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl delete namespaces my-ns\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"描述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#描述"}},[s._v("#")]),s._v(" 描述")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" kubectl describe namespaces default \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[s._v("#")]),s._v(" 查看")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl get namespaces dedault\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[s._v("#")]),s._v(" pod")]),s._v(" "),t("h3",{attrs:{id:"概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),t("p",[t("strong",[s._v("pod")]),s._v(" 运行中的一组容器，"),t("strong",[s._v("k8s")]),s._v(" 中应用的最小单位。")]),s._v(" "),t("p",[t("strong",[s._v("docker 容器 k8s关系")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-K9DUJg.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-W6lool.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"创建-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建-2"}},[s._v("#")]),s._v(" 创建")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("命令行创建")]),s._v(" "),t("p",[t("code",[s._v("kubectl run mynginx --image=nginx")])])]),s._v(" "),t("li",[t("p",[s._v("yaml 文件创建")])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ol",[t("li",[t("p",[s._v("创建")]),s._v(" "),t("p",[t("code",[s._v("kubectl apply -f nginx.yaml")])])]),s._v(" "),t("li",[t("p",[s._v("删除")]),s._v(" "),t("p",[t("code",[s._v("kubectl delete -f nginx.yaml")])])])]),s._v(" "),t("h3",{attrs:{id:"查看所有-pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看所有-pod"}},[s._v("#")]),s._v(" 查看所有 pod")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取默认空间的 所有pod ")]),s._v("\nkubectl get pods  -A\n\nkubectl get pods\n\nkubectl get pod mynginx\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"查看日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看日志"}},[s._v("#")]),s._v(" 查看日志")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Pod的运行日志")]),s._v("\nkubectl logs  mynginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-Zjh8RJ.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"描述下-pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#描述下-pod"}},[s._v("#")]),s._v(" 描述下 pod")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl describe pod my-dep-5b7868d854-kj65g \nkubectl describe pod mynginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-DR4fjf.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-KdeOZ9.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"删除-pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除-pod"}},[s._v("#")]),s._v(" 删除 pod")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl delete pod mynginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"pod-更详细信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod-更详细信息"}},[s._v("#")]),s._v(" pod 更详细信息")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl get pods -owide\n\nkubectl get pods  myapp -owide \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-wawyZE.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"进入-pod-内"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进入-pod-内"}},[s._v("#")]),s._v(" 进入 pod 内")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it myapp /bin/bash\n \n kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it myapp -- /bin/bash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"多容器-pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多容器-pod"}},[s._v("#")]),s._v(" 多容器 pod")]),s._v(" "),t("blockquote",[t("p",[s._v("pod 内多容器 端口不能重复")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("myapp2.yaml")]),s._v(" "),t("p",[t("code",[s._v("kubectl apply -f myapp2.yaml")])])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp2\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp2\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("查看 "),t("strong",[s._v("pod")]),s._v(" 信息")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl get pod myapp2 -owide\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-mOvMgV.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("进入 "),t("strong",[s._v("pod")]),s._v(" 内 "),t("strong",[s._v("redis")]),s._v(" 或 "),t("strong",[s._v("nginx")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it  myapp2  --container"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx  -- /bin/bash\nkubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it  myapp2  --container"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis  -- redis-cli\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-ieGC2V.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("strong",[s._v("master")]),s._v(" 节点 访问 "),t("strong",[s._v("nginx")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-pEEXK6.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"deployment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[s._v("#")]),s._v(" deployment")]),s._v(" "),t("blockquote",[t("p",[s._v("Pod拥有多副本，自愈，扩缩容等能力")])]),s._v(" "),t("p",[t("strong",[s._v("创建一个 deployment")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl create deployment myredis --image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"自愈"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自愈"}},[s._v("#")]),s._v(" 自愈")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("查看当前 "),t("strong",[s._v("deployment")]),s._v(" 的 "),t("strong",[s._v("redis pod")])]),s._v(" "),t("p",[t("code",[s._v("kubectl get pod myredis-6cd79bdd4c-chsvc")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-OE86Gg.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("删除 这个pod")]),s._v(" "),t("p",[t("code",[s._v("kubectl delete pod myredis-6cd79bdd4c-chsvc")])])]),s._v(" "),t("li",[t("p",[s._v("查看当前 pod")]),s._v(" "),t("p",[s._v("k8s 又重新创建了一个 redis 实例 ，查看当前的 "),t("strong",[s._v("pod")])]),s._v(" "),t("p",[t("code",[s._v("kubectl get pods")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-ta8u9m.png",alt:""}})])])]),s._v(" "),t("h3",{attrs:{id:"多副本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多副本"}},[s._v("#")]),s._v(" 多副本")]),s._v(" "),t("ol",[t("li",[s._v("创建 3 个 "),t("strong",[s._v("nginx-cluster")]),s._v(" 副本")])]),s._v(" "),t("ul",[t("li",[s._v("shell")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl create deployment nginx-cluster --image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --replicas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("yaml")]),s._v(" "),t("p",[t("code",[s._v("vim nginx-cluster.yml")])])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("应用文件")]),s._v(" "),t("p",[t("code",[s._v("kubectl apply -f nginx-cluster.yml")])])])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("查看副本")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl get deployments.apps nginx-cluster -owide\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"扩缩容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#扩缩容"}},[s._v("#")]),s._v(" 扩缩容")]),s._v(" "),t("h4",{attrs:{id:"扩张"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#扩张"}},[s._v("#")]),s._v(" 扩张")]),s._v(" "),t("p",[s._v("现在 "),t("strong",[s._v("nginx-cluster")]),s._v("  是 3个，扩容到5个")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl scale --replicas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" deployment/nginx-cluster\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-ujvZGP.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"缩小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缩小"}},[s._v("#")]),s._v(" 缩小")]),s._v(" "),t("p",[s._v("现在 "),t("strong",[s._v("nginx-cluster")]),s._v("  是 "),t("strong",[s._v("5")]),s._v(" 个，缩小到 "),t("strong",[s._v("2")]),s._v(" 个")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl scale --replicas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" deployment/nginx-cluster\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-6s0oxe.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"故障转移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#故障转移"}},[s._v("#")]),s._v(" 故障转移")]),s._v(" "),t("p",[s._v("假设任一 "),t("strong",[s._v("nginx-cluster")]),s._v(" 因意外故障退出，集群会再创建一个副本")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("初始 4 个  "),t("strong",[s._v("nginx-cluster")])]),s._v(" "),t("p",[t("code",[s._v("kubectl get pod -w")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-G2I9N5.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("删掉一个 "),t("strong",[s._v("pod")])]),s._v(" "),t("p",[t("code",[s._v("kubectl delete pod nginx-cluster-765bcf57d5-hpqzp")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-wM6L4I.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("新的 "),t("strong",[s._v("pod 7mb5")]),s._v(" 创建")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/naturalCloud/personal-cloud-image-warehouse/main/naturalCloud/2022-06-05-zghpXq.png",alt:""}})])])]),s._v(" "),t("h3",{attrs:{id:"滚动更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#滚动更新"}},[s._v("#")]),s._v(" 滚动更新")]),s._v(" "),t("p",[t("strong",[s._v("滚动更新")]),s._v(" 是指起先起一个新版本的容器，测试完毕后，下线一个老版本的，切换流量。")]),s._v(" "),t("ul",[t("li",[s._v("创建 "),t("strong",[s._v("deployment")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl apply -f nginx-cluster.yml \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("使用 "),t("strong",[s._v("nginx")]),s._v(" 新的镜像版本")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployment/nginx-cluster "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.16.1 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("查看 "),t("strong",[s._v("nginx-cluster")]),s._v(" 当前状态")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl rollout status deployment nginx-cluster \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Waiting for deployment "nginx-cluster" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment "nginx-cluster" rollout to finish: 1 old replicas are pending termination...\ndeployment "nginx-cluster" successfully rolled out\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"版本回退"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本回退"}},[s._v("#")]),s._v(" 版本回退")]),s._v(" "),t("ol",[t("li",[s._v("检查 "),t("strong",[s._v("nginx-cluster")]),s._v(" 上线历史")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl rollout "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" deployment/nginx-cluster\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出如下")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("deployment.apps/nginx-cluster \nREVISION  CHANGE-CAUSE\n3         &lt;none>\n4         kubectl set image deployment/nginx-cluster nginx=nginx:1.16.1 --record=true\n5         kubectl set image deployment/nginx-cluster nginx=nginx:1.22.0 --record=true\n6         kubectl set image deployment/nginx-cluster nginx=nginx:1.21.6 --record=true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("查看某个版本具体历史")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl rollout "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" deployment/nginx-cluster --revision"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如下")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("deployment.apps/nginx-cluster with revision #5\nPod Template:\n  Labels:\tapp=nginx-cluster\n\tpod-template-hash=6b8c587c9d\n  Annotations:\tkubernetes.io/change-cause: kubectl set image deployment/nginx-cluster nginx=nginx:1.22.0 --record=true\n  Containers:\n   nginx:\n    Image:\tnginx:1.22.0\n    Port:\t&lt;none>\n    Host Port:\t&lt;none>\n    Environment:\t&lt;none>\n    Mounts:\t&lt;none>\n  Volumes:\t&lt;none>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("回滚版本")])]),s._v(" "),t("ul",[t("li",[s._v("回滚到之前版本")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl rollout undo deployment/nginx-cluster\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("回滚到指定的版本")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl rollout undo deployment/nginx-cluster --to-revision"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[s._v("#")]),s._v(" service")]),s._v(" "),t("p",[s._v("将一组 "),t("strong",[s._v("pods")]),s._v(" 公开为网络服务的方法")])])}),[],!1,null,null,null);a.default=n.exports}}]);